{"version":3,"sources":["webpack:///./src/API/user.js","webpack:///./src/views/login/index.vue?c534","webpack:///src/views/login/index.vue","webpack:///./src/views/login/index.vue?e0c5","webpack:///./src/views/login/index.vue","webpack:///./src/views/login/index.vue?4667"],"names":["login","data","request","method","url","getSmsCode","mobile","getUserInfo","getUserChannels","addFollow","userId","target","getUserProfile","updateUserPhoto","updateUserProfile","render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","ref","model","value","userName","callback","$$v","$set","expression","slot","on","$event","isCountDownShow","onSendSmsCode","_v","onLogin","staticRenderFns","name","components","props","code","methods","component"],"mappings":"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","file":"js/chunk-07508837.09c16357.js","sourcesContent":["import request from '@/utils/request'\n\nexport const login = data => {\n  return request({\n    method: 'POST',\n    url: '/app/v1_0/authorizations',\n    data\n  })\n}\nexport const getSmsCode = mobile => {\n  return request({\n    method: 'GET',\n    url: `/app/v1_0/sms/codes/${mobile}`\n\n  })\n}\nexport const getUserInfo = () => {\n  return request({\n    method: 'GET',\n    url: `/app/v1_0/user`\n\n  })\n}\nexport const getUserChannels = () => {\n  return request({\n    method: 'GET',\n    url: '/app/v1_0/user/channels'\n\n  })\n}\n// 关注文章\nexport const addFollow = userId => {\n  return request({\n    method: 'POST',\n    url: `/app/v1_0/user/followings`,\n    data: {\n      target: userId\n    }\n\n  })\n}\n// 取消关注\nexport const deleteFollow = userId => {\n  return request({\n    method: 'DELETE',\n    url: `/app/v1_0/user/followings/${userId}`\n  })\n}\n// 获取用户个人信息\nexport const getUserProfile = () => {\n  return request({\n    method: 'GET',\n    url: `/app/v1_0/user/profile`\n\n  })\n}\n// 编辑用户照片资料\n\nexport const updateUserPhoto = data => {\n  return request({\n    method: 'PATCH',\n    url: `/app/v1_0/user/photo`,\n    data\n  })\n}\n// 更新用户资料\nexport const updateUserProfile = data => {\n  return request({\n    method: 'PATCH',\n    url: `/app/v1_0/user/profile`,\n    data\n  })\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login\"},[_c('van-nav-bar',{attrs:{\"title\":\"登录\"}}),_c('ValidationObserver',{ref:\"form\"},[_c('ValidationProvider',{attrs:{\"name\":\"手机号\",\"rules\":\"required\"}},[_c('van-field',{attrs:{\"label\":\"手机号\",\"placeholder\":\"请输入手机号\"},model:{value:(_vm.userName.mobile),callback:function ($$v) {_vm.$set(_vm.userName, \"mobile\", $$v)},expression:\"userName.mobile\"}},[_c('i',{staticClass:\"iconfont icon-phone_icon\",attrs:{\"slot\":\"left-icon\"},slot:\"left-icon\"})])],1),_c('ValidationProvider',{attrs:{\"name\":\"验证码\",\"rules\":\"required\"}},[_c('van-field',{attrs:{\"label\":\"验证码\",\"placeholder\":\"请输入6位验证码\"},model:{value:(_vm.userName.code),callback:function ($$v) {_vm.$set(_vm.userName, \"code\", $$v)},expression:\"userName.code\"}},[_c('i',{staticClass:\"iconfont icon-mima\",attrs:{\"slot\":\"left-icon\"},slot:\"left-icon\"}),(_vm.isCountDownShow)?_c('van-count-down',{attrs:{\"slot\":\"button\",\"time\":1000 * 60,\"format\":\" ss s\"},on:{\"finish\":function($event){_vm.isCountDownShow = false}},slot:\"button\"}):_c('van-button',{attrs:{\"slot\":\"button\",\"size\":\"small\",\"type\":\"primary\"},on:{\"click\":_vm.onSendSmsCode},slot:\"button\"},[_vm._v(\" 发送验证码 \")])],1)],1)],1),_c('div',{staticClass:\"btn\"},[_c('van-button',{attrs:{\"type\":\"info\"},on:{\"click\":_vm.onLogin}},[_vm._v(\"登录\")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"login\">\n    <!-- 导航栏 -->\n    <van-nav-bar title=\"登录\" />\n    <!-- 表单 -->\n    <ValidationObserver ref=\"form\">\n      <ValidationProvider name=\"手机号\"  rules=\"required\">\n      <van-field\n         v-model=\"userName.mobile\"\n         label=\"手机号\"\n         placeholder=\"请输入手机号\"\n         >\n        <i class=\"iconfont icon-phone_icon\" slot=\"left-icon\"></i>\n      </van-field>\n      </ValidationProvider>\n\n      <ValidationProvider name=\"验证码\"  rules=\"required\">\n      <van-field v-model=\"userName.code\"\n        label=\"验证码\"\n        placeholder=\"请输入6位验证码\"\n        >\n        <i class=\"iconfont icon-mima\" slot=\"left-icon\"></i>\n            <van-count-down\n             slot=\"button\"\n             v-if=\"isCountDownShow\"\n             :time=\" 1000 * 60 \"\n             format=\" ss s\"\n             @finish=\"isCountDownShow = false\"\n              />\n            <van-button\n             v-else\n             slot=\"button\"\n             size=\"small\"\n             type=\"primary\"\n             @click=\"onSendSmsCode\"\n            >\n             发送验证码\n            </van-button>\n      </van-field>\n      </ValidationProvider>\n    </ValidationObserver>\n    <div class=\"btn\">\n      <van-button type=\"info\" @click=\"onLogin\">登录</van-button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { login, getSmsCode } from '@/API/user'\nimport { validate } from 'vee-validate'\nexport default {\n  name: 'loginPage',\n  components: {},\n  props: {},\n  data () {\n    return {\n      userName: {\n        mobile: '13911111111',\n        code: '246810'\n\n      },\n      isCountDownShow: false\n    }\n  },\n  methods: {\n    async onLogin () {\n      const user = this.userName\n      // 表单验证\n      const success = await this.$refs.form.validate()\n\n      // 如果验证失败，提示错误消息，停止表单提交\n      if (!success) {\n        // 这里加定时器的原因是因为获取验证失败的结果有延迟问题，并不是我们的原因\n        setTimeout(() => {\n          const errors = this.$refs.form.errors\n          // forEach 无法停止\n          // find 方法会遍历数组，对每个元素执行方法中的条件判定\n          // const item = Object.values(errors).find(item => item[0])\n\n          // 找到第1个有错误的字段并弹出提示\n          for (let key in errors) {\n            const item = errors[key]\n            if (item[0]) {\n              this.$toast(item[0])\n              return\n            }\n          }\n        }, 100)\n        return\n      }\n      // 通过验证，弹出loading\n      this.$toast.loading({\n        duration: 0,\n        message: '登录中...',\n        forbidClick: true\n\n      })\n\n      // 提交请求\n      try {\n        const res = await login(user)\n        console.log(res)\n        // 把token储存到Vuex容器中\n        this.$store.commit('setUser', res.data.data)\n\n        this.$toast.success('登录成功')\n        const redirect = this.$route.query.redirect || '/'\n        this.$router.push(redirect)\n      } catch (err) {\n        this.$toast.fail('手机号或验证码错误')\n      }\n    },\n\n    async onSendSmsCode () {\n      const { mobile } = this.userName\n      // 校验\n\n      const validateResult = await validate(mobile, 'required|mobile', { name: '手机号' })\n      if (!validateResult.valid) {\n        this.$toast(validateResult.errors[0])\n        return\n      }\n      try {\n        this.isCountDownShow = true\n        await getSmsCode(mobile)\n      } catch (error) {\n        console.log(error)\n        this.isCountDownShow = false\n        if (error.response.status === 429) {\n          this.$toast('请勿频繁发送')\n          return\n        }\n        this.$toast('发送失败')\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n\n.btn {\n  padding: 26px 16px;\n\n  .van-button {\n    width: 100%;\n    border-radius: 4px;\n    background: #6db4fb;\n  }\n}\n\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=1851d865&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=1851d865&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1851d865\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=1851d865&lang=less&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=1851d865&lang=less&scoped=true&\""],"sourceRoot":""}